<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Questionnaire</title>
    <style>
        /* Basic styles for the body and container */
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .section {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fff;
        }
        h2 {
            margin-top: 0;
        }
        table {
            width: 100%;
        }
        td {
            padding: 10px;
            vertical-align: top;
        }
        .custom-select-lg {
            width: 100%;
            height: 100px; /* Example height for large select fields */
            padding: 6px 12px;
            line-height: 1.5;
        }
        
        .custom-select-sm {
            width: 50%;
            height: 30px; /* Example height for small select fields */
            padding: 5px 10px;
            font-size: 14px;
            line-height: 1.3;
        }
        .btn-group {
            text-align: center;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .hidden {
            display: none;
        }

        .back-btn {
            margin-right: 10px;
        }

        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px; /* Adjust as needed */
        }
        
        .form-group label {
            flex: 0 0 100px; /* Adjust the width of the label container */
            margin-right: 0;
            display: flex;
            align-items: center;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            margin-left: 220px; /* Adjust this value to control the distance between the label and input */
        }
        
        .hidden {
            display: none;
        }
        
    </style>
    <script>
        function toggleCategoryFields(checkbox) {
            var targetId = checkbox.dataset.target;
            var targetField = document.getElementById(targetId);
            if (checkbox.checked) {
                targetField.classList.remove('hidden');
            } else {
                targetField.classList.add('hidden');
            }
        }
        
        document.addEventListener('change', function(event) {
            if (event.target.classList.contains('boolean-field')) {
                toggleCategoryFields(event.target);
            }
        });               
        /* Functions to navigate between different sections of the form */
        function showIntendedUse() {
            document.getElementById('general-info').classList.add('hidden');
            document.getElementById('intended-use').classList.remove('hidden');
        }
        function showKeyComponents() {
            document.getElementById('intended-use').classList.add('hidden');
            document.getElementById('key-components').classList.remove('hidden');
        }
        function showDataProcessing() {
            document.getElementById('key-components').classList.add('hidden');
            document.getElementById('data-processing').classList.remove('hidden');
        }
        function showHumanInvolvement() {
            document.getElementById('data-processing').classList.add('hidden');
            document.getElementById('human-involvement').classList.remove('hidden');
        }
        function showRiskProfile() {
            document.getElementById('human-involvement').classList.add('hidden');
            document.getElementById('risk-profile').classList.remove('hidden');
        }
        function showQuality() {
            document.getElementById('risk-profile').classList.add('hidden');
            document.getElementById('quality').classList.remove('hidden');
        }
        function showPredetermined() {
            document.getElementById('quality').classList.add('hidden');
            document.getElementById('pre-determined').classList.remove('hidden');
        }
        function showComp_Cert() {
            document.getElementById('pre-determined').classList.add('hidden');
            document.getElementById('comp_cert').classList.remove('hidden');
        }
        function backToGeneralInfo() {
            document.getElementById('intended-use').classList.add('hidden');
            document.getElementById('general-info').classList.remove('hidden');
        }
        function backToIntendedUse() {
            document.getElementById('key-components').classList.add('hidden');
            document.getElementById('intended-use').classList.remove('hidden');
        }
        function backToKeyComponents() {
            document.getElementById('data-processing').classList.add('hidden');
            document.getElementById('key-components').classList.remove('hidden');
        }
        function backToDataProcessing() {
            document.getElementById('human-involvement').classList.add('hidden');
            document.getElementById('data-processing').classList.remove('hidden');
        }
        function backToHumanInvolvement() {
            document.getElementById('risk-profile').classList.add('hidden');
            document.getElementById('human-involvement').classList.remove('hidden');
        }
        function backToRiskProfile() {
            document.getElementById('quality').classList.add('hidden');
            document.getElementById('risk-profile').classList.remove('hidden');
        }
        function backToQuality() {
            document.getElementById('pre-determined').classList.add('hidden');
            document.getElementById('quality').classList.remove('hidden');
        }
        function backToPredetermined() {
            document.getElementById('comp_cert').classList.add('hidden');
            document.getElementById('pre-determined').classList.remove('hidden');
        }
        
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
</head>
<body>
    <div class="container">
        <form method="post" action="{{ url_for('index') }}">
            <div id="general-info" class="section">
                <h2>1. General Information</h2>
            <table>
                <!-- General Information fields -->
                <tr>
                    <td>
                        1.1 {{ form.name.label }}:
                        <span data-toggle="tooltip" data-placement="right" title="Enter the full name of the software">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </td>
                    <td>{{ form.name }}</td>
                </tr>
                <tr>
                    <td>
                        1.2 {{ form.version.label }}:
                        <span data-toggle="tooltip" data-placement="right" title="Enter the version of the software">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </td>
                    <td>{{ form.version }}</td>
                </tr>
                <tr>
                    <td>
                        1.3 {{ form.providers.label }}:
                        <span data-toggle="tooltip" data-placement="right" title="List the providers of the software">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </td>
                    <td>{{ form.providers }}</td>
                </tr>
                <tr>
                    <td>
                        1.4 {{ form.developers.label }}:
                        <span data-toggle="tooltip" data-placement="right" title="List the developers of the software">
                            <i class="fas fa-question-circle"></i>
                        </span>
                    </td>
                    <td>{{ form.developers }}</td>
                </tr>
            </table>
            <div class="btn-group">
                <button type="button" onclick="showIntendedUse()">Next</button>
                <button type="submit" class="btn btn-success">Submit</button>
            </div>
        </div>
        <div id="intended-use" class="section hidden">
                <h2>2. Intended Use</h2>
                <table>
                    <!-- Intended Use fields -->
                    <tr>
                        <td>
                            2.1 {{ form.domain.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Enter the domain of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.domain }}</td>
                    </tr>
                    <tr>
                        <td>
                            2.2 {{ form.purpose.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Describe the purpose of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.purpose }}</td>
                    </tr>
                    <tr>
                        <td>
                            2.3 {{ form.capability.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Outline the capabilities of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.capability }}</td>
                    </tr>
                    <tr>
                        <td>
                            2.4 {{ form.deployers.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="List the deployers of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.deployers }}</td>
                    </tr>
                    <tr>
                        <td>
                            2.5 {{ form.aiTechniques.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="List the AI techniques used">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.aiTechniques }}</td>
                    </tr>
                    <tr>
                        <td>
                            2.6 {{ form.aisubjects.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Identify the AI subjects of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.aisubjects }}</td>
                    </tr>
                </table>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToGeneralInfo()">Back</button>
                    <button type="button" onclick="showKeyComponents()">Next</button>
                </div>
            </div>

            <div id="key-components" class="section hidden">
                <h2>3. Key Components</h2>
                <table id="key-components-table">
                    <!-- Key Components fields -->
                    <tr class="original-row-3">
                        <td>3.1 {{ form.data_type.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.data_type }}</td>
                    </tr>
                    <tr class="original-row-3">
                        <td>
                            3.2 {{ form.key_name.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Enter the name of the key component">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.key_name }}</td>
                    </tr>
                    <tr class="original-row-3">
                        <td>
                            3.3 {{ form.description.label }}:
                            <span data-toggle="tooltip" data-placement="right" title="Describe the key component">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.description }}</td>
                    </tr>
                </table>
                <button type="button" onclick="addKeyComponents()">Add</button>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToIntendedUse()">Back</button>
                    <button type="button" onclick="showDataProcessing()">Next</button>
                </div>
            </div>
            <div id="data-processing" class="section hidden">
                <h2>4. Data Processing</h2>
                <table id="data-processing-table">
                    <tr class="original-row">
                        <td>4.1 {{ form.data_name.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.data_name }}</td>
                    </tr>
                    <tr class="original-row">
                        <td>4.2 {{ form.isPersonalData.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isPersonalData }}</td>
                    </tr>
                    <tr class="original-row">
                        <td>4.3 {{ form.isAnonymisedData.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isAnonymisedData }}</td>
                    </tr>
                    <tr class="original-row">
                        <td>4.4 {{ form.isLisencedData.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isLisencedData }}</td>
                    </tr>
                </table>
                <div class="btn-group">
                    <button type="button" onclick="addDataProcessing()">Add</button>
                </div>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToKeyComponents()">Back</button>
                    <button type="button" onclick="showHumanInvolvement()">Next</button>
                </div>
            </div>
            <div id="human-involvement" class="section hidden">
                <h2>5. Human Involvement</h2>
                <table id="human-involvement-table">
                    <!-- Human Involvement fields -->
                    <tr>
                        <td>5.1 {{ form.level_of_automation.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.level_of_automation }}</td>
                    </tr>
                    <tr>
                        <td>5.2 {{ form.human_involvement.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.human_involvement }}</td>
                    </tr>
                    <tr class="original-row-2">
                        <td>5.3 {{ form.involved_person.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.involved_person }}</td>
                    </tr>
                    <tr class="original-row-2">
                        <td>5.4 {{ form.isIntended.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isIntended }}</td>
                    </tr>
                    <tr class="original-row-2">
                        <td>5.5 {{ form.isActive.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isActive }}</td>
                    </tr>
                    <tr class="original-row-2">
                        <td>5.6 {{ form.isInformed.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the title for this data processing entry">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.isInformed }}</td>
                    </tr>
                </table>
                <div class="btn-group">
                    <button type="button" onclick="addHumanInvolvement()">Add</button>
                </div>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToDataProcessing()">Back</button>
                    <button type="button" onclick="showRiskProfile()">Next</button>
                </div>
            </div>            
            <div id="risk-profile" class="section hidden">
                <h2>6. Risk Profile</h2>
                <table style="width: 100%;">
                    <table border="1" style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr>
                                <th rowspan="2">Impact on</th>
                                <th colspan="3">Risks</th>
                                <th colspan="6">Measures</th>
                            </tr>
                            <tr>
                                <td><strong>6.1 {{ form.likelihood.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.2 {{ form.severity.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.3 {{ form.residual.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.4 {{ form.isOrganisational.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.5 {{ form.isTechnical.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.6 {{ form.isMonitoring.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.7 {{ form.isSecurity.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.8 {{ form.isTransparency.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                                <td><strong>6.9 {{ form.isLogging.label }}</strong>
                                    <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                        <i class="fas fa-question-circle"></i>
                                    </span></td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td rowspan="2">Health & Safety</td>
                            </tr>
                            <tr>
                                <td>{{ form.likelihood }}</td>
                                <td>{{ form.severity }}</td>
                                <td>{{ form.residual }}</td>
                                <td>{{ form.isOrganisational }}</td>
                                <td>{{ form.isTechnical }}</td>
                                <td>{{ form.isMonitoring }}</td>
                                <td>{{ form.isSecurity }}</td>
                                <td>{{ form.isTransparency }}</td>
                                <td>{{ form.isLogging }}</td>
                            </tr>
                            <tr>
                                <td rowspan="2">Fundamental Rights</td>
                            </tr>
                            <tr>
                                <td>{{ form.likelihood }}</td>
                                <td>{{ form.severity }}</td>
                                <td>{{ form.residual }}</td>
                                <td>{{ form.isOrganisational }}</td>
                                <td>{{ form.isTechnical }}</td>
                                <td>{{ form.isMonitoring }}</td>
                                <td>{{ form.isSecurity }}</td>
                                <td>{{ form.isTransparency }}</td>
                                <td>{{ form.isLogging }}</td>
                            </tr>
                            <tr>
                                <td rowspan="2">Society</td>
                            </tr>
                            <tr>
                                <td>{{ form.likelihood }}</td>
                                <td>{{ form.severity }}</td>
                                <td>{{ form.residual }}</td>
                                <td>{{ form.isOrganisational }}</td>
                                <td>{{ form.isTechnical }}</td>
                                <td>{{ form.isMonitoring }}</td>
                                <td>{{ form.isSecurity }}</td>
                                <td>{{ form.isTransparency }}</td>
                                <td>{{ form.isLogging }}</td>
                            </tr>
                            <tr>
                                <td rowspan="2">Environmental</td>
                            </tr>
                            <tr>
                                <td>{{ form.likelihood }}</td>
                                <td>{{ form.severity }}</td>
                                <td>{{ form.residual }}</td>
                                <td>{{ form.isOrganisational }}</td>
                                <td>{{ form.isTechnical }}</td>
                                <td>{{ form.isMonitoring }}</td>
                                <td>{{ form.isSecurity }}</td>
                                <td>{{ form.isTransparency }}</td>
                                <td>{{ form.isLogging }}</td>
                            </tr>
                        </tbody>
                    </table>
                </table>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToHumanInvolvement()">Back</button>
                    <button type="button" onclick="showQuality()">Next</button>
                </div>
            </div>            
            <div id="quality" class="section hidden">
                <h2>7. Quality</h2>
                <table>
                    <!-- Quality Field -->
                    <tr>
                        <td>7.1 {{ form.accuracy.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.accuracy }}</td>
                    </tr>
                    <tr>
                        <td>7.2 {{ form.cybersecurity.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.cybersecurity }}</td>
                    </tr>
                    <tr>
                        <td>7.3 {{ form.robustness.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.robustness }}</td>
                    </tr>
                    <tr>
                        <td>7.4 {{ form.fairness.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.fairness }}</td>
                    </tr>
                    <tr>
                        <td>7.5 {{ form.functional.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.functional }}</td>
                    </tr>
                    <tr>
                        <td>7.6 {{ form.explainability.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.explainability }}</td>
                    </tr>
                    <tr>
                        <td>7.7 {{ form.usability.label }}
                            <span data-toggle="tooltip" data-placement="right" title="Enter the accuracy of the software">
                                <i class="fas fa-question-circle"></i>
                            </span>
                        </td>
                        <td>{{ form.usability }}</td>
                    </tr>
                </table>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToRiskProfile()">Back</button>
                    <button type="button" onclick="showPredetermined()">Next</button>
                </div>
            </div>
            <div id="pre-determined" class="section hidden">
                <h2>8. Pre-determined Changes</h2>
                <table border="1" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th rowspan="2"></th>
                            <th><strong>8.1 {{ form.frequency.label }}</strong></th>
                            <th colspan="2">Impact on</th>
                        </tr>
                        <tr>
                            <td></td>
                            <td><strong>8.2 {{ form.performance.label }}</strong></td>
                            <td><strong>8.3 {{ form.risks.label }}</strong></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Susbehaved model</td>
                            <td>{{ form.frequency }}</td>
                            <td>{{ form.performance }}</td>
                            <td>{{ form.risks }}</td>
                        </tr>
                        <tr>
                            <td>Mitigation measures</td>
                            <td>{{ form.frequency }}</td>
                            <td>{{ form.performance }}</td>
                            <td>{{ form.risks }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToQuality()">Back</button>
                    <button type="button" onclick="showComp_Cert()">Next</button>
                </div>
            </div>            
            <div id="comp_cert" class="section hidden">
                <h2>9. Compliance & Certification</h2>
                <table border="1" style="width:100%; border-collapse:collapse;">
                    <tbody>
                        <tr>
                            <td><strong>9.1 {{ form.regulations.label }}</strong></td>
                            <td>{{ form.regulations }}</td>
                        </tr>
                        <tr>
                            <td><strong>9.2 {{ form.standards.label }}</strong></td>
                            <td>{{ form.standards }}</td>
                        </tr>
                        <tr>
                            <td><strong>9.3 {{ form.codes.label }}</strong></td>
                            <td>{{ form.codes }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="btn-group">
                    <button type="button" class="back-btn" onclick="backToPredetermined()">Back</button>
                    <button type="submit" class="btn btn-success">Submit</button>
                </div>
            </div>            
        </form>
    </div>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
    <!-- Include jQuery library -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        function addHumanInvolvement() {
            // Get the table where the human involvement fields are located
            var table = document.getElementById('human-involvement-table');
            
            // Define the class of the rows to be duplicated
            var rowsToDuplicate = document.querySelectorAll('.original-row-2');
            
            // Create a document fragment to hold the new rows
            var fragment = document.createDocumentFragment();
            
            var newRows = [];
            rowsToDuplicate.forEach(function(row) {
                // Clone each row
                var newRow = row.cloneNode(true);
                fragment.appendChild(newRow);
                newRows.push(newRow);
            });
    
            // Create a remove button row and add it to the fragment
            var removeButtonRow = document.createElement('tr');
            var removeButtonCell = document.createElement('td');
            removeButtonCell.colSpan = 2;  // Span the button across two columns
            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.textContent = 'Remove';
            removeButton.onclick = function() {
                // Remove the new rows associated with this remove button
                newRows.forEach(function(row) {
                    if (row.parentNode) {
                        row.parentNode.removeChild(row);
                    }
                });
                if (removeButtonRow.parentNode) {
                    removeButtonRow.parentNode.removeChild(removeButtonRow);
                }
            };
            removeButtonCell.appendChild(removeButton);
            removeButtonRow.appendChild(removeButtonCell);
            
            // Append the remove button row to the fragment
            fragment.appendChild(removeButtonRow);
            
            // Append the fragment to the table
            table.appendChild(fragment);
        }   
        function addDataProcessing() {
            // Get the table where the human involvement fields are located
            var table = document.getElementById('data-processing-table');
            
            // Define the class of the rows to be duplicated
            var rowsToDuplicate = document.querySelectorAll('.original-row');
            
            // Create a document fragment to hold the new rows
            var fragment = document.createDocumentFragment();
            
            var newRows = [];
            rowsToDuplicate.forEach(function(row) {
                // Clone each row
                var newRow = row.cloneNode(true);
                fragment.appendChild(newRow);
                newRows.push(newRow);
            });
        
            // Create a remove button row and add it to the fragment
            var removeButtonRow = document.createElement('tr');
            var removeButtonCell = document.createElement('td');
            removeButtonCell.colSpan = 2;  // Span the button across two columns
            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.textContent = 'Remove';
            removeButton.onclick = function() {
                // Remove the new rows associated with this remove button
                newRows.forEach(function(row) {
                    if (row.parentNode) {
                        row.parentNode.removeChild(row);
                    }
                });
                if (removeButtonRow.parentNode) {
                    removeButtonRow.parentNode.removeChild(removeButtonRow);
                }
            };
            removeButtonCell.appendChild(removeButton);
            removeButtonRow.appendChild(removeButtonCell);
            
            // Append the remove button row to the fragment
            fragment.appendChild(removeButtonRow);
            
            // Append the fragment to the table
            table.appendChild(fragment);
        
            // Add category fields to the duplicated rows
            newRows.forEach(function(row) {
                var checkbox = row.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    addCategoryField(row);
                }
            });
        }
        function addKeyComponents() {
            // Get the table where the human involvement fields are located
            var table = document.getElementById('key-components-table');
            
            // Define the class of the rows to be duplicated
            var rowsToDuplicate = document.querySelectorAll('.original-row-3');
            
            // Create a document fragment to hold the new rows
            var fragment = document.createDocumentFragment();
            
            var newRows = [];
            rowsToDuplicate.forEach(function(row) {
                // Clone each row
                var newRow = row.cloneNode(true);
                fragment.appendChild(newRow);
                newRows.push(newRow);
            });
    
            // Create a remove button row and add it to the fragment
            var removeButtonRow = document.createElement('tr');
            var removeButtonCell = document.createElement('td');
            removeButtonCell.colSpan = 2;  // Span the button across two columns
            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.textContent = 'Remove';
            removeButton.onclick = function() {
                // Remove the new rows associated with this remove button
                newRows.forEach(function(row) {
                    if (row.parentNode) {
                        row.parentNode.removeChild(row);
                    }
                });
                if (removeButtonRow.parentNode) {
                    removeButtonRow.parentNode.removeChild(removeButtonRow);
                }
            };
            removeButtonCell.appendChild(removeButton);
            removeButtonRow.appendChild(removeButtonCell);
            
            // Append the remove button row to the fragment
            fragment.appendChild(removeButtonRow);
            
            // Append the fragment to the table
            table.appendChild(fragment);
        }   
        function addCategoryField(booleanRow) {
            var categoryRow = document.createElement('tr');
            var categoryCellLabel = document.createElement('td');
            var categoryCellInput = document.createElement('td');
            var categoryInput = document.createElement('input');
        
            categoryCellLabel.textContent = 'Category';
            categoryCellInput.appendChild(categoryInput);
            categoryRow.appendChild(categoryCellLabel);
            categoryRow.appendChild(categoryCellInput);
        
            booleanRow.querySelector('input').addEventListener('change', function () {
                if (this.checked) {
                    booleanRow.parentNode.insertBefore(categoryRow, booleanRow.nextSibling);
                } else {
                    if (categoryRow.parentNode) {
                        categoryRow.parentNode.removeChild(categoryRow);
                    }
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function () {
            var originalRows = document.querySelectorAll('.original-row');
            originalRows.forEach(function(row) {
                var checkbox = row.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    addCategoryField(row);
                }
            });
        });
    </script>
</body>
</html>
